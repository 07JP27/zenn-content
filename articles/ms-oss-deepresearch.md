---
title: "MicrosoftãŒå…¬é–‹ã—ã¦ã„ã‚‹Deep Researchã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç†è§£ã—ã¦ã¿ã‚‹ï¼ˆã¤ã„ã§ã«Cï¼ƒåŒ–ï¼‰"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["azure", "openai", "deepresearch", "csharp", "microsoft"]
published: false
publication_name: "microsoft"
---
## ã¯ã˜ã‚ã«
LLMã®ç™ºå±•ã¯ç›®è¦šã¾ã—ãã€ç›´è¿‘ã§ã¯ChatGPTã‚„Geminiãªã©ã•ã¾ã–ã¾ãªLLMã‚µãƒ¼ãƒ“ã‚¹ã§Deep Researchã¨å‘¼ã°ã‚Œã‚‹è¤‡é›‘ãªèª¿æŸ»ã‚’è‡ªå¾‹çš„ã«å®Ÿè¡Œã—ã€æ•°ç™¾ã®æƒ…å ±æºã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã—ãŸãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
å¤šãã®è£½å“ã§ã¯ã€æƒ…å ±æºã¯Webä¸Šã®æƒ…å ±ã‚’ã‚½ãƒ¼ã‚¹ã¨ã—ã¾ã™ãŒã€Microsoft 365 Copilotã®ã€Œ[ãƒªã‚µãƒ¼ãƒãƒ£ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ](https://blogs.windows.com/japan/2025/04/14/researcher-agent-in-microsoft-365-copilot/)ã€æ©Ÿèƒ½ã§ã¯ã€Microsoft Graphã‚’é€šã˜ã¦çµ„ç¹”å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ãƒ¡ãƒ¼ãƒ«ãªã©ã«å¯¾ã—ã¦Deep Researchã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«Deep Researchã¯Webä¸Šã®ã‚½ãƒ¼ã‚¹ã ã‘ã§ãªãè‡ªç¤¾ã®æƒ…å ±è³‡ç”£ã‚’æ´»ç”¨ã—ã¦èª¿æŸ»ã‚’è¡Œã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
åŒæ§˜ã«è‡ªç¤¾ã§LLMã‚’çµ„ã¿è¾¼ã‚“ã ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç¤¾å†…å¤–å‘ã‘ã«é–‹ç™ºã—ã¦ã„ã‚‹é–‹ç™ºè€…ã«ã¨ã£ã¦ã‚‚ã€ãã®ã‚µãƒ¼ãƒ“ã‚¹ã«Deep Researchã‚’å®Ÿè£…ã—ãŸã„å ´é¢ãŒã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ãã“ã§ä»Šå›ã¯Microsoftã¯GitHubã«ã¦å…¬é–‹ã—ã¦ã„ã‚‹Deep Researchã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç†è§£ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã«ç´è§£ã„ã¦ã„ãã¾ã™ã€‚
ã¾ãŸã€ä½µã›ã¦Pythonã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹æœ¬å®¶ã‚³ãƒ¼ãƒ‰ã‚’C#ã§å®Ÿè£…ã—ãªãŠã—ã¦ã¿ã¾ã™ã€‚

https://github.com/Azure-Samples/deepresearch

ã¡ãªã¿ã«ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯Microsoftã®å¹´æ¬¡ãƒ•ãƒ©ã‚°ã‚·ãƒƒãƒ—ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã§ã‚ã‚‹[Microsoft Build 2025](https://news.microsoft.com/build-2025/)å†…ã§ãƒãƒ³ã‚ºã‚ªãƒ³ãƒ©ãƒœã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã—ã¦ä½¿ã‚ã‚ŒãŸã‚ˆã†ã§ã™ã€‚

â€»ã“ã‚Œä»¥é™ç‰¹ã«æ³¨é‡ˆã®ãªã„ç”»åƒã¯ã€ä¸Šè¨˜ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã®å¼•ç”¨ã¾ãŸã¯è‘—è€…ãŒç‹¬è‡ªã«ä½œæˆã—ãŸã‚‚ã®ã§ã™ã€‚

## ãƒªãƒã‚¸ãƒˆãƒªã®å…¨ä½“åƒã‚’ç†è§£ã™ã‚‹
æ³¨ç›®ã™ã¹ãéƒ¨åˆ†ã®ã¿ã‚’æŠœãå‡ºã—ã¦ã„ã¾ã™ãŒã€ä»¥ä¸‹ãŒã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã®å…¨ä½“åƒã§ã™ã€‚

```
deepresearch/
â”œâ”€â”€ app/ ----------------> ãƒ¡ã‚¤ãƒ³ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ main.py ---------> ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚„å…¨ä½“ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‹…ã£ã¦ã„ã‚‹
â”‚   â”œâ”€â”€ prompts.py ------> ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¸€å¼ãŒå…¥ã£ã¦ã„ã‚‹å®šæ•°ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ states.py -------> æ¨è«–å®Ÿè¡Œæ™‚ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹
â”‚   â”œâ”€â”€ formatting.py ---> æ¤œç´¢çµæœã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã«ã™ã‚‹Utilã‚¯ãƒ©ã‚¹
â”‚   â”œâ”€â”€ static/ ---------> JSã‚„CSSãªã©ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ index.html --> UIç”¨ã®HTMLã€‚ç‰¹ã«SPAãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãªã©ã¯ä½¿ã£ã¦ã„ãªã„
â””â”€â”€ infra/ --------------> azdã‚³ãƒãƒ³ãƒ‰ã§Azureãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œã‚‹ãŸã‚ã®Bicepãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```

ã“ã“ã¾ã§ã–ã£ã¨ãƒªãƒã‚¸ãƒˆãƒªã‚’ä¿¯ç°ã—ã¦ã¿ã¦ã€ç‰¹ç­†ã™ã¹ããƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
#### APIã¯FastAPIã§å®Ÿè£…
FastAPIã‚’ä½¿ç”¨ã—ã¦APIãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚FastAPIã¯Pythonã§Web APIã‚’ä½œã‚‹æ™‚ã¯æœ€è¿‘ã‚ˆãã¿ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

#### Webæ¤œç´¢APIã«ã¯Tavilyã‚’ä½¿ç”¨
Webæ¤œç´¢APIã¨ã—ã¦Tavilyã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
Tavilyã¯ã€Webæ¤œç´¢APIã‚’æä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã€Webã‚µã‚¤ãƒˆã«ã€ŒConnect Your LLMã€€to the Webã€ã¨ã‚ã‚‹ã‚ˆã†ã«ã€ç‰¹ã«AIã‚„LLMã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®åˆ©ç”¨ãŒæƒ³å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

https://tavily.com

### LangGraphã‚’ä½¿ç”¨ã—ãŸçŠ¶æ…‹ç®¡ç†ã¨é·ç§»
LangGraphã®StateGraphã‚’ä½¿ç”¨ã—ãŸçŠ¶æ…‹é·ç§»ã‚°ãƒ©ãƒ•ã‚’æ§‹æˆã—ã€ã‚¯ã‚¨ãƒªã®ç”Ÿæˆã‚„Webæ¤œç´¢ãªã©ã‚’ãƒãƒ¼ãƒ‰ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

https://zenn.dev/pharmax/articles/a9b9762c2c384e#langgraph%E3%81%AEstate%E3%81%AE%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9

#### WebSocketé€šä¿¡ã‚’å®Ÿè£…
Deep Researchã¯æ·±ã„æ´å¯Ÿã‚’å¾—ã‚‹ãŸã‚ã«ã€ç¹°ã‚Šè¿”ã—æ¤œç´¢ã¨æ¨è«–ãŒè¡Œã‚ã‚Œã¾ã™ã€‚ãã‚Œã¯é«˜ç²¾åº¦ãªçµæœã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ä¸€æ–¹ã§æœ€çµ‚çš„ãªå›ç­”ã¾ã§æ™‚é–“ã‚’è¦ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€WebSocketé€šä¿¡ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«é€²æ—çŠ¶ã‚’é€šçŸ¥ã™ã‚‹ä»•çµ„ã¿ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚
WebSocketé€šä¿¡ã¯ã€FastAPIã®`WebSocket`ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

#### azd upã‚³ãƒãƒ³ãƒ‰ã«å¯¾å¿œ
Azure Developer CLIï¼ˆazdï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€Azureãƒªã‚½ãƒ¼ã‚¹ã‚’ç°¡å˜ã«ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
infraãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«Bicepãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã€azd upã‚³ãƒãƒ³ãƒ‰ã§Azureãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆã¨ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ãŒå®Œçµã—ã¾ã™ã€‚

https://zenn.dev/microsoft/articles/59787e7a8fc2a9

## Deep Researchæ©Ÿæ§‹ã‚’ç†è§£ã™ã‚‹
### å…¨ä½“ã®æµã‚Œã‚’ç†è§£ã™ã‚‹
ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®Deep Researchæ©Ÿæ§‹ã®æµã‚Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
1. ã‚¯ã‚¨ãƒªç”Ÿæˆï¼šãƒˆãƒ”ãƒƒã‚¯ã«é–¢ã—ã¦æœ€é©ãªæ¤œç´¢ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆ
2. Webæ¤œç´¢ï¼šTavily APIã‚’ä½¿ç”¨ã—ã¦è¤‡æ•°ã®æ¤œç´¢ã‚’è¡Œã„æƒ…å ±ã‚’åé›†
3. è¦ç´„ï¼šAIãŒåé›†ã—ãŸæƒ…å ±ã‚’åˆ†æã—è¦ç´„
4. ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼šã‚·ã‚¹ãƒ†ãƒ ãŒçŸ¥è­˜ã®ã‚®ãƒ£ãƒƒãƒ—ã‚’ç‰¹å®šã—ã•ã‚‰ãªã‚‹èª¿æŸ»ã‚’è¡Œã†
5. ç¹°ã‚Šè¿”ã—ï¼šãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®çµæœã€è¿½åŠ ã®èª¿æŸ»ãŒå¿…è¦ã§ã‚ã‚Œã°èª¿æŸ»ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã—å®Ÿæ–½
6. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼šç”»åƒã‚’å«ã‚“ã æœ€çµ‚çš„ã‹ã¤åŒ…æ‹¬çš„ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ

![](https://github.com/Azure-Samples/deepresearch/raw/main/images/deep_researcher_architecture.png)

### ã‚³ãƒ¼ãƒ‰ã‚’ç†è§£ã™ã‚‹
ã“ã“ã¾ã§ã®ãƒªãƒã‚¸ãƒˆãƒªã®å…¨ä½“åƒã‚’è¸ã¾ãˆã‚‹ã¨ã€åŸºæœ¬çš„ã«ã¯`app/main.py`ã®Deep Researchæ©Ÿæ§‹ã§è¡Œãªã£ã¦ã„ã‚‹å‡¦ç†ã‚’ç†è§£ã§ããã†ã§ã™ã€‚

```mermaid
graph TD
    %% ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
    get_html[get_html]
    websocket_endpoint[websocket_endpoint]
    
    %% ã‚°ãƒ©ãƒ•é–¢é€£
    setup_graph[setup_graph]
    stream_graph_updates[stream_graph_updates]
    
    %% ç ”ç©¶ãƒ—ãƒ­ã‚»ã‚¹
    generate_query[generate_query]
    web_research[web_research]
    summarize_sources[summarize_sources]
    reflect_on_summary[reflect_on_summary]
    finalize_summary[finalize_summary]
    route_research[route_research]
    
    %% ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    strip_thinking_tokens[strip_thinking_tokens]
    
    %% æ¥ç¶šç®¡ç†
    ConnectionManager[ConnectionManager]
    connect[ConnectionManager.connect]
    disconnect[ConnectionManager.disconnect]
    send[ConnectionManager.send]
    
    %% å¤–éƒ¨ä¾å­˜ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ï¼‰
    get_current_date[get_current_date - prompts.py]
    deduplicate_and_format_sources[deduplicate_and_format_sources - formatting.py]
    format_sources[format_sources - formatting.py]
    SummaryState[SummaryState - states.py]
    SummaryStateInput[SummaryStateInput - states.py]
    SummaryStateOutput[SummaryStateOutput - states.py]
    
    %% ä¾å­˜é–¢ä¿‚
    websocket_endpoint --> setup_graph
    websocket_endpoint --> stream_graph_updates
    websocket_endpoint --> ConnectionManager
    
    setup_graph --> generate_query
    setup_graph --> web_research
    setup_graph --> summarize_sources
    setup_graph --> reflect_on_summary
    setup_graph --> finalize_summary
    setup_graph --> route_research
    
    generate_query --> strip_thinking_tokens
    generate_query --> get_current_date
    
    web_research --> deduplicate_and_format_sources
    web_research --> format_sources
    
    summarize_sources --> strip_thinking_tokens
    
    reflect_on_summary --> strip_thinking_tokens
    
    finalize_summary --> finalize_summary
    
    %% å…¨ã¦ã®ç ”ç©¶ãƒ—ãƒ­ã‚»ã‚¹é–¢æ•°ã¯SummaryStateã‚’ä½¿ç”¨
    generate_query -.-> SummaryState
    web_research -.-> SummaryState
    summarize_sources -.-> SummaryState
    reflect_on_summary -.-> SummaryState
    finalize_summary -.-> SummaryState
    route_research -.-> SummaryState
    
    %% setup_graphã§ã®çŠ¶æ…‹ã‚¯ãƒ©ã‚¹ä½¿ç”¨
    setup_graph -.-> SummaryState
    setup_graph -.-> SummaryStateInput
    setup_graph -.-> SummaryStateOutput
    
    %% ConnectionManagerã®å†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰
    ConnectionManager --> connect
    ConnectionManager --> disconnect
    ConnectionManager --> send
    
    %% å®Ÿç·šã¯ç›´æ¥çš„ãªé–¢æ•°å‘¼ã³å‡ºã—
    %% ç‚¹ç·šã¯å‹å®šç¾©ã‚„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä½¿ç”¨
    
    classDef processNode fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef helperNode fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef externalNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef managerNode fill:#fff3e0,stroke:#e65100,stroke-width:2px
    
    class generate_query,web_research,summarize_sources,reflect_on_summary,finalize_summary,route_research processNode
    class strip_thinking_tokens,setup_graph,stream_graph_updates helperNode
    class get_current_date,deduplicate_and_format_sources,format_sources,SummaryState,SummaryStateInput,SummaryStateOutput externalNode
    class ConnectionManager,connect,disconnect,send managerNode
```

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®2ã¤ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚
- `/`ï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®HTMLã¨JSã‚„CSSãªã©ã‚’è¿”ã™ã€‚[Jinja2Templatesã‚’ä½¿ç”¨ã—ã¦HTMLã¨JS/CSSã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦è¿”ã™ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L38)
- `/we/{client_id}`ï¼šWebSocketé€šä¿¡ã‚’ä½¿ã£ã¦Deep Resarchã‚’å®Ÿè¡Œã™ã™ã‚‹ã€‚ã“ã£ã¡ãŒãƒ¡ã‚¤ãƒ³ã€‚client_idã¯[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã—ã¦ã„ã‚‹](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/static/js/main.js#L60)

ãã®ãŸã‚ã€`/we/{client_id}`ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‡¦ç†ã‚’ç¢ºèªã™ã‚Œã°ã‚ˆã•ãã†ã§ã™ã€‚ã“ã®ãƒ‘ã‚¹ã¯`websocket_endpoint`é–¢æ•°ã«ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨WSæ¥ç¶šãŒç¢ºç«‹ã•ã‚Œã¾ã™ã€‚ãã®å¾Œã€[`setup_graph`é–¢æ•°](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L306)ãŒå‘¼ã³å‡ºã•ã‚Œã€Deep Researchã®çŠ¶æ…‹é·ç§»ã‚°ãƒ©ãƒ•ãŒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚
`setup_graph`é–¢æ•°ã§ã¯ã€LangGraphã®StateGraphã‚’ä½¿ç”¨ã—ã¦ã€Deep Researchã®å„ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆã‚¯ã‚¨ãƒªç”Ÿæˆã€Webæ¤œç´¢ã€è¦ç´„ã€ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãªã©ï¼‰ã‚’ãƒãƒ¼ãƒ‰ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```python
def setup_graph():
    # Add nodes and edges
    builder = StateGraph(SummaryState, input=SummaryStateInput, output=SummaryStateOutput)
    builder.add_node("generate_query", generate_query)
    builder.add_node("web_research", web_research)
    builder.add_node("summarize_sources", summarize_sources)
    builder.add_node("reflect_on_summary", reflect_on_summary)
    builder.add_node("finalize_summary", finalize_summary)
    
    # Add edges
    builder.add_edge(START, "generate_query")
    builder.add_edge("generate_query", "web_research")
    builder.add_edge("web_research", "summarize_sources")
    builder.add_edge("summarize_sources", "reflect_on_summary")
    builder.add_conditional_edges("reflect_on_summary", route_research)
    builder.add_edge("finalize_summary", END)
    
    return builder.compile()
```

ã“ã“ã§ç‰¹ç­†ã™ã¹ãã¯`builder.add_conditional_edges("reflect_on_summary", route_research)`ã®éƒ¨åˆ†ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦Deep Researchã®ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒƒãƒ—ã§ã€æ¤œç´¢ã‚’ç¹°ã‚Šè¿”ã™ã®ã‹ã€æœ€çµ‚çš„ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã®ã‹ã‚’æ¡ä»¶åˆ†å²ã§åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã€‚[`route_research`é–¢æ•°](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L287)ãŒãã®æ¡ä»¶åˆ†å²ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```python
async def route_research(state: SummaryState):
    if state.research_loop_count <= 3:
        # ...çœç•¥
        return "web_research"
    else:
        # ...çœç•¥
        return "finalize_summary"
```

ã“ã®å‡¦ç†ã‹ã‚‰ã€Deep Researchã®ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒƒãƒ—ã§ã€3å›ã¾ã§ã®ç¹°ã‚Šè¿”ã—æ¤œç´¢ã‚’è¡Œã„ã€ãã‚Œä»¥é™ã¯æœ€çµ‚çš„ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

### å„ãƒãƒ¼ãƒ‰å‡¦ç†ã‚’ç†è§£ã™ã‚‹
ãƒãƒ¼ãƒ‰ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã€[å…¨ä½“ã®æµã‚Œã‚’ç†è§£ã™ã‚‹](###å…¨ä½“ã®æµã‚Œã‚’ç†è§£ã™ã‚‹)ã®æµã‚Œã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã™ã‚‹ã¨å¤§ä½“åå‰ã‹ã‚‰å‡¦ç†ãŒæƒ³åƒã§ãã¾ã™ã€‚
- [generate_query](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L74)ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‹ã‚‰æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’ä½œæˆã™ã‚‹ï¼ˆLLMåˆ©ç”¨ï¼‰
- [web_research](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L113)ï¼šWebã‚’æ¤œç´¢ã™ã‚‹
- [summarize_sources](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L145)ï¼šã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆLLMåˆ©ç”¨ï¼‰
- [reflect_on_summary](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L194)ï¼šã‚µãƒãƒªãƒ¼ã‚’ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã—ã¦ä¸è¶³ã—ã¦ã„ã‚‹éƒ¨åˆ†ã‚’è£œã†ãŸã‚ã®ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆï¼ˆLLMåˆ©ç”¨ï¼‰
- [finalize_summary](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L245)ï¼šã“ã“ã¾ã§ã®æ¤œç´¢çµæœã®ã‚µãƒãƒªãƒ¼ã‚’ä½¿ã£ã¦æœ€çµ‚çš„ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã€‚ã‚ãã¾ã§æ©Ÿæ¢°çš„ã«ç”Ÿæˆã™ã‚‹ã ã‘ã§LLMã¯åˆ©ç”¨ã—ã¦ã„ãªã„ã€‚

ãƒãƒ¼ãƒ‰ã®é–¢æ•°ã‹ã‚‰å‘¼ã°ã‚Œã‚‹Utilé–¢æ•°ã¨ã—ã¦[`strip_thinking_tokens`](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L59C5-L59C26)ãŒ`main.py`ã®ä¸­ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®é–¢æ•°ã¯`generate_query`ã€`summarize_sources`ã€`reflect_on_summary`é–¢æ•°ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã¦ã„ã¾ã™ã€‚READMEã‚„ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ¨è«–ã®LLMã¨ã—ã¦[Deep Seekã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒæƒ³å®šã•ã‚Œã¦ã„ã‚‹](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/main.py#L50)ã‚ˆã†ã§ã™ã€‚Deep Seekã®æ¨è«–ã§ã¯æ€è€ƒéç¨‹ã‚’<think>~</think>ã¨ã„ã†ãƒˆãƒ¼ã‚¯ãƒ³ã§å›²ã£ã¦å‡ºåŠ›ã•ã‚Œã‚‹ãŸã‚ã€ãã®ãƒˆãƒ¼ã‚¯ãƒ³ã§å›²ã¾ã‚ŒãŸæ€è€ƒã®æ–‡å­—åˆ—ã¨ãã‚Œä»¥å¤–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å›ç­”ã®æ–‡å­—åˆ—ã‚’åˆ†é›¢ã™ã‚‹ãŸã‚ã«ã“ã®é–¢æ•°ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’èª­ã¿è§£ã
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯å„ãƒãƒ¼ãƒ‰ã®é–¢æ•°ã§LLMã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹3ã¤åˆ†ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚
åŸæ–‡ã¯ã‚‚ã¡ã‚ã‚“è‹±èªã§ã™ãŒã€ã“ã“ã§ã¯ç†è§£ã‚’åŠ©ã‘ã‚‹ãŸã‚ã«æ—¥æœ¬èªè¨³ã§è¨˜è¼‰ã—ã¾ã™ã€‚

- [query_writer_instructions](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/prompts.py#L7)ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒˆãƒ”ãƒƒã‚¯ã«é–¢ã™ã‚‹æƒ…å ±ã‚’ã‚‚ã¨ã«ã€æœ€é©ãªæ¤œç´¢ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
:::details query_writer_instructions ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæ—¥æœ¬èªè¨³ï¼‰
:::

- [summarizer_instructions](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/prompts.py#L35)ï¼šåé›†ã—ãŸæƒ…å ±ã‚’è¦ç´„ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
:::details summarizer_instructions ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæ—¥æœ¬èªè¨³ï¼‰
:::

- [reflection_instructions](https://github.com/Azure-Samples/deepresearch/blob/92dad3ba0ec27651a6858c5110482bfb25a7d15d/app/prompts.py#L65)ï¼šè¦ç´„çµæœã‚’ã‚‚ã¨ã«ã€ã•ã‚‰ãªã‚‹èª¿æŸ»ãŒå¿…è¦ãªå ´åˆã®ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
:::details reflection_instructions ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæ—¥æœ¬èªè¨³ï¼‰
:::

## ã¾ã¨ã‚ã¨æ”¹å–„ã¨ç™ºå±•
- ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿæ§‹ã®æ”¹å–„
ç¾åœ¨ã¯å›ºå®šå€¤ã§3å›ã¾ã§ã®ç¹°ã‚Šè¿”ã—æ¤œç´¢ã‚’è¡Œã†ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ãŒã€ã‚´ãƒ¼ãƒ«ã®åˆ¤å®šè‡ªä½“ã‚‚LLMãŒè¡Œã†ã“ã¨ã«ã‚ˆã‚Šã€ã‚ˆã‚Šç¢ºå®Ÿã‹ã¤æŸ”è»Ÿãªèª¿æŸ»ãŒå¯èƒ½ã«ãªã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

- æ§‹é€ åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®åˆ©ç”¨
ç¾åœ¨ã¯ã€Deep Researchã®çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§å‡ºåŠ›ã—ã¦ã„ã¾ã™ãŒã€JSON Modeãªã©æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿å½¢å¼ï¼ˆä¾‹ãˆã°JSONã‚„XMLï¼‰ã§å‡ºåŠ›ã™ã‚‹ã“ã¨ã§ç¢ºå®Ÿãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®çµ„ã¿è¾¼ã¿ãŒæœŸå¾…ã§ãã¾ã™ã€‚ãŸã ã—ã€JSON Modeã¯ã€Azureã§ã¯Azure OpenAI Serviceã®æ©Ÿèƒ½ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€Azure OpenAI Serviceã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- Deep Seekä»¥å¤–ã®ãƒ¢ãƒ‡ãƒ«ã¸ã®å¯¾å¿œ


## C#ã§å®Ÿè£…ã—ãªãŠã™
æ®‹å¿µãªãŒã‚‰LangGraphã¯C#ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€çŠ¶æ…‹é·ç§»ã‚’ç‹¬è‡ªã«å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

