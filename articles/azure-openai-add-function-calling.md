---
title: "Azure Open AIでFunction Callingを使う！"
emoji: "📞"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["azure", "openai"]
published: false
publication_name: "microsoft"
---

# なぜFunction Callingが必要なのか(モチベーション)
ChatGPTをはじめとするGPTシリーズのリリースから数ヶ月が経過し、市場が徐々にGPTに慣れてきました。それに伴い、単純な「チャット」だけではなく様々なアプリケーションとの連携の需要が上がっています。

しかし、GPTの出力は自然言語であるためアプリケーションとの相性が悪いという弱点があります。例えば以下のような問題が発生しうる可能性がありました。
- JSONで出力してね、と言っても余計な日本語をつけてきたり
    ![](/images/azure-openai-add-function-calling/issue1.png)
- それっぽいJSONを出力してくれるが、アプリケーション側のスキーマと合致しないJSONだったり
    ![](/images/azure-openai-add-function-calling/issue2.png)

そのような場合に備えてアプリケーション側でリトライ処理などを実装しますが、リトライしたところで上記の問題が100%解決する保証がないので、どこかで諦めないといけなかったりします。今まではこのような問題を解決するためにプロンプトエンジニアリングを用いてなるべく所望のデータ形式を得られるようにプロンプトの試行錯誤が繰り返されていました。

上記のような問題やプロンプトエンジニアリングの手間を解消し、**GPTとアプリケーションを確実に連携できるような仕組みが必要**になってきました。それを実現するための仕組みが Function Calling です。


# Functions Callingの動きと仕組み


まずはFunction Callingを使用した場合の全体の動きをみてみましょう。
前章ではフキダシの中がプロンプトと出力になっていましたが、この図ではあくまで「動きの概要」になっていることに注意してご覧ください。
![](/images/azure-openai-add-function-calling/overview.png)

:::message
ちなみに上記の図ではレシピを検索した後に⑤⑥でさらにChatGPTに対して文章の生成をリクエストしていますが、これは必須ではありません。
検索したレシピをそのままアプリケーションの出力として④の直後に機械的に出力するといったことも可能ですし、さらにそこから別の機能へ連携する、なども可能です。
:::

ポイントは**リクエストの形式が入力と使える機能とその機能を使う場合に必要なデータスキーマに別れている**ことです。今までは入力の中で全てを行う必要があり、ここが自然言語ゆえの相性の悪さがありましたが、Function Callingのリクエスト形式としてそれらが分離されたことによって、確実な機能の呼び出しとデータの受け渡しができるようになりました。




# 試してみる

## 素のWeb APIで試す

## Python SDKで試す

## .NET 　 SDKで試す
